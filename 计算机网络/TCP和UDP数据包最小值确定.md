![以太帧结构.jpeg](../assets/以太帧结构.png)

- **物理层**  以太网MAC帧  ( **最大值** $8 + (6+6+2+1500+4) = 1526$​  ,**最小值** $8 + (6+6+2+46+4) = 72$​​ )
- **数据链路层**  MAC帧  (  **最大值** $6 + 6 + 2 + 1500 + 4 = 1518$​​​  ,  **最小值** $6 + 6 + 2 + 46 + 4 = 64$​​​ )
  - ARP (   $6 + 6 + 2 + 28 + 4 =46$​  )
- **网络层和传输层**  IP数据包 保证不小于46  , `IPV6没有拓展首部, IPV6最低要求运营商链路可以传输 1280 MTU, IPv4最大首部长度60字节`
  - **IPv4和TCP无拓展选项首部的最小值**   $(TCP=20)+ (IPV4=20) +(DATA=6) =46 $​​​ )
    - **IPv6和TCP的最小值**   $(TCP=20)+ (IPV6=40) +(DATA=1) =61$​​​​​ ) 
  - **IPv4UDP无拓展选项首部和的最小值**   $(UDP=8)+ (IPV4=20) +(DATA=18) =46 $ )
    - **IPv6和UDP首部的最小值**   $(UDP=8)+ (IPV6=40) +(DATA=1) =49$​ )
  - **IPv4和ICMP无拓展选项首部的最小值**   $(ICMP=8)+ (IPV4=20) +(DATA=18) =46$​ )
    - **IPv6和ICMP首部的最小值**   $(ICMP=8)+ (IPV6=40) +(DATA=1) =49 $​​​ )



TCP、UDP数据包最小值的确定

     在用UDP局域网通信时，经常发生“Hello World”来进行测试，但是“Hello World”并不满足最小有效数据(64-46)的要求，为什么小于18个字节，对方仍然可用收到呢？因为在链路层的MAC子层中会进行数据补齐，不足18个字节的用0补齐。但当服务器在公网，客户端在内网，发生小于18个字节的数据，就会出现接收端收不到数据的情况。
    
       以太网EthernetII规定，以太网帧数据域部分最小为46字节，也就是以太网帧最小是6＋6＋2＋46＋4＝64。除去4个字节的FCS，因此，抓包时就是60字节。当数据字段的长度小于46字节时，MAC子层就会在数据字段的后面填充以满足数据帧长不小于64字节。由于填充数据是由MAC子层负责，也就是设备驱动程序。不同的抓包程序和设备驱动程序所处的优先层次可能不同，抓包程序的优先级可能比设备驱动程序更高，也就是说，我们的抓包程序可能在设备驱动程序还没有填充不到64字节的帧的时候，抓包程序已经捕获了数据。因此不同的抓包工具抓到的数据帧的大小可能不同。下列是本人分别用wireshark和sniffer抓包的结果，对于TCP 的ACK确认帧的大小一个是54字节，一个是60字节，wireshark抓取时没有填充数据段，sniffer抓取时有填充数据段。

