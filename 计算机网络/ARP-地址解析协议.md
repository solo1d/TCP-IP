# ARP 地址解析协议

一个网络 , 如以太网可以同时被不同的网络层使用.

当一台主机把以太网数据帧发送到位于同一局域网上的另一台主机时，是根据 48 bit的以太网地址(MAC地址)来确定目的接口的。设备驱动程序从不检查 I P 数据报中的目的 I P 地址.

**地址解析为这两种不同的地址形式提供映射: (32位IP地址与48位MAC地址) 32bit的IP地址和数据链路层使用的任何类型的地址.**

- **ARP(地址解析协议) : 将32位IP 地址解析成 48位 MAC地址.**
  - ARP位IP地址到对应的硬件地址之间提供动态映射. 
    - 这个过程是自动完成的, 一般应用程序用户或系统管理员不必关心.

- **RARP(逆地址解析协议): 将48位MAC地址 解析成 32位IP地址.**
  - RARP 是被那些没有磁盘驱动器的系统使用( 无盘工作站或X终端).
    - 需要系统管理员手工设置

**在ARP背后有一个基本概念:**

- **硬件接口有一个硬件地址(48bit的 MAC地址)**
  - **在硬件层次上进行数据帧交换必须有正确的接口地址(IP和MAC)**
    - **在知道目的主机的IP地址并不能让内核发送一帧数据给主机.**
      - **内核(以太网驱动程序) 必须知道目的端的硬件地址(MAC) 才能发送数据.**
  - **点对点链路不使用ARP.**
    - 当设置这些链路时(一般在引导过程进行), 必须告知内核链路每一端的IP地址.像以太网地址这样的硬件地址并不涉及.

### ARP 高速缓存

ARP高效运行的关键是由于每个主机上都有一个ARP高速缓存。

这个高速缓存存放了最近Internet地址到硬件地址之间的映射记录。

高速缓存中每一项的生存时间一般为20分钟，起始时间从被创建时开始算起

**使用`arp -a` 命令可查看ARP 高速缓存的内容.**

### ARP 的分组格式

A R P 可 以 用 于 其 他 类型的网络，可以解析 I P 地 址 以 外 的 地 址

在以太网上解析IP地址时，ARP请求和应答分组的格式.

![ARP请求和应答分组的格式](/Users/ns/gitNote/TCP-IP/assets/ARP请求和应答分组格式.png)

- 以太网首部中 两个字节长的 **帧类型** 表示后面数据的类型.
  - 对于 ARP 请求和应答来说, 该字段的值为 0x0806
- 紧跟着 **帧类型字段** 的后四个字段`(硬件类型,协议地址,硬件地址长度,协议地址长度)`, 指定了最后四个字段的类型和长度
- **以太网首部** 字段中的 目的质地为全1 的特殊地址是广播地址.
  - 电缆上的所有以太网接口都要接收广播的数据帧.
- **硬件类型** 字段表示硬件地址的类型
  - 值为1 时表示以太网地址.
- **协议类型** 字段表示要映射的协议地址类型
  - 值为 0x0800 时 表示 IP地址
  - 它的值与包含IP数据包的以太网数据帧中的类型字段相同.
- **硬件地址长度** 和 **协议地址长度** 分别指出硬件地址和协议地址 的长度，以字节为单位
  - 对于以太网上IP地址的ARP请求或应答来说,他们的值分别时6和4
- **OP(操作)** 字段 指出四种操作类型:
  - 1 :ARP请求
  - 2 : ARP应答
  - 3 :RARP请求
  - 4 :RARP应答
  - **这个字段很重要,因为ARP请求和ARP应答的`帧类型`字段是相同的.(有这个字段才能区分)**
- 最后四个字段:
  - **发送端以太网地址**    和以太网首部的 以太网源地址 字段内容相同
  - **发送端IP地址**
  -  **目的以太网地址**  接收这个数据报的 MAC地址主机
  -  **目的IP地址**  接收这个数据报的 IP地址主机,(和以太网首部的 以太网目的地址 字段内容相同)

对于一个ARP请求来说，除目的端硬件地址外的所有其他的字段都有填充值。当系统收到一份目的端为本机的ARP请求报文后，它就把硬件地址填进去，然后用两个目的端地址分别替换两个发送端地址，并把操作字段置为2，最后把它发送回去。





























